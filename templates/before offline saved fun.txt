<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <meta name="theme-color" content="#0a1a0f" />
  <title>AgriUstaad â€” by Team AgriCore</title>
  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" href="/static/icons/icon-192.png" type="image/png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet" />

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --c-bg:           #080f0b;
  --c-surface-md:   rgba(255,255,255,0.06);
  --c-surface-hi:   rgba(255,255,255,0.10);
  --c-border:       rgba(255,255,255,0.08);
  --c-border-hi:    rgba(255,255,255,0.16);
  --c-green-900:    #0a2e14;
  --c-green-700:    #1a5c2a;
  --c-green-500:    #2d8a44;
  --c-green-400:    #3dab55;
  --c-green-300:    #5ecb74;
  --c-green-100:    #b8f0c2;
  --c-gold:         #c9a84c;
  --c-gold-light:   #e8c96a;
  --c-amber:        #f0a830;
  --c-error:        #e05252;
  --c-error-bg:     rgba(224,82,82,0.08);
  --c-error-border: rgba(224,82,82,0.25);
  --c-text:         #e8f4eb;
  --c-text-2:       rgba(232,244,235,0.65);
  --c-text-3:       rgba(232,244,235,0.38);
  --glass-blur-lg:  40px;
  --r-md:   18px;
  --r-lg:   28px;
  --r-xl:   40px;
  --r-full: 9999px;
  --shadow-lg:   0 20px 60px rgba(0,0,0,0.60);
  --shadow-glow: 0 0 40px rgba(45,138,68,0.18);
  --ff-display: 'Cormorant Garamond', Georgia, serif;
  --ff-body:    'DM Sans', system-ui, sans-serif;
  --ff-mono:    'DM Mono', monospace;
  --transition: 0.3s cubic-bezier(0.4,0,0.2,1);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  background: var(--c-bg);
  color: var(--c-text);
  font-family: var(--ff-body);
  font-size: 15px;
  line-height: 1.6;
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BACKGROUND MESH + GRAIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0;
  background:
    radial-gradient(ellipse 80% 60% at 20% 10%, rgba(20,80,35,0.45) 0%, transparent 60%),
    radial-gradient(ellipse 60% 50% at 80% 80%, rgba(10,50,25,0.40) 0%, transparent 55%),
    radial-gradient(ellipse 50% 70% at 60% 30%, rgba(45,138,68,0.10) 0%, transparent 50%),
    var(--c-bg);
  animation: meshDrift 18s ease-in-out infinite alternate;
}
@keyframes meshDrift { 0%{filter:hue-rotate(0deg);}100%{filter:hue-rotate(12deg);} }
body::after {
  content: ''; position: fixed; inset: 0; z-index: 1; pointer-events: none; opacity: 0.022;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E");
  background-repeat: repeat; background-size: 128px;
}
.orb { position:fixed;border-radius:50%;filter:blur(80px);pointer-events:none;z-index:0;animation:orbFloat 20s ease-in-out infinite; }
.orb-1{width:420px;height:420px;background:radial-gradient(circle,rgba(45,138,68,0.22) 0%,transparent 70%);top:-120px;left:-120px;animation-delay:0s;}
.orb-2{width:320px;height:320px;background:radial-gradient(circle,rgba(201,168,76,0.12) 0%,transparent 70%);bottom:80px;right:-80px;animation-delay:-8s;}
.orb-3{width:250px;height:250px;background:radial-gradient(circle,rgba(30,100,50,0.18) 0%,transparent 70%);top:50%;left:60%;animation-delay:-14s;}
@keyframes orbFloat{0%,100%{transform:translate(0,0) scale(1);}33%{transform:translate(30px,-40px) scale(1.05);}66%{transform:translate(-20px,25px) scale(0.96);}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APP WRAPPER â€” gets blurred behind language screen
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#appWrapper {
  filter: blur(18px) brightness(0.4) saturate(0.5);
  transform: scale(1.04);
  pointer-events: none;
  transition: filter 0.9s ease, transform 0.9s ease, opacity 0.6s ease;
  opacity: 0;
}
#appWrapper.revealed {
  filter: none;
  transform: scale(1);
  pointer-events: auto;
  opacity: 1;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FLASH OVERLAY â€” cinematic reveal
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#flashOverlay {
  position: fixed; inset: 0; z-index: 9999;
  background: radial-gradient(ellipse at center, rgba(94,203,116,0.9) 0%, rgba(45,138,68,0.95) 40%, rgba(8,15,11,1) 100%);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease;
}
#flashOverlay.flash-in  { opacity: 1;  pointer-events: all; }
#flashOverlay.flash-out {
  opacity: 0;
  transition: opacity 1.2s cubic-bezier(0.4,0,0.2,1);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LANGUAGE SELECTOR OVERLAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#langOverlay {
  position: fixed; inset: 0; z-index: 5000;
  display: flex; align-items: center; justify-content: center;
  padding: 20px;
  transition: opacity 0.5s ease, transform 0.5s ease;
}
#langOverlay.hiding {
  opacity: 0;
  transform: scale(0.96);
  pointer-events: none;
}

.lang-card {
  width: 100%; max-width: 520px;
  background: rgba(10,18,12,0.82);
  backdrop-filter: blur(40px) saturate(180%);
  -webkit-backdrop-filter: blur(40px) saturate(180%);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 40px;
  padding: 44px 36px 36px;
  box-shadow: 0 32px 80px rgba(0,0,0,0.7), 0 0 60px rgba(45,138,68,0.12), inset 0 1px 0 rgba(255,255,255,0.08);
  position: relative;
  overflow: hidden;
  animation: cardEntrance 0.7s cubic-bezier(0.34,1.3,0.64,1) both;
}
@keyframes cardEntrance {
  from { opacity:0; transform:translateY(40px) scale(0.94); }
  to   { opacity:1; transform:translateY(0) scale(1); }
}
.lang-card::before {
  content: '';
  position: absolute; top: 0; left: 10%; right: 10%; height: 1px;
  background: linear-gradient(90deg, transparent, rgba(94,203,116,0.4) 50%, transparent);
}

/* Decorative ring behind card */
.lang-card-glow {
  position: absolute; inset: -60px;
  background: radial-gradient(ellipse at center, rgba(45,138,68,0.08) 0%, transparent 70%);
  pointer-events: none; z-index: -1;
  animation: glowPulse 4s ease-in-out infinite alternate;
}
@keyframes glowPulse { 0%{opacity:0.6;}100%{opacity:1;} }

.lang-brand {
  display: flex; align-items: center; gap: 12px; margin-bottom: 8px;
}
.lang-logo {
  display: grid; place-items: center;
  width: 46px; height: 46px;
  background: linear-gradient(135deg, var(--c-green-700), var(--c-green-500));
  border-radius: 14px; font-size: 22px;
  box-shadow: 0 6px 18px rgba(45,138,68,0.4), inset 0 1px 0 rgba(255,255,255,0.15);
}
.lang-brand-name {
  font-family: var(--ff-display);
  font-size: 28px; font-weight: 600;
  color: var(--c-text); letter-spacing: 0.01em;
}

.lang-tagline {
  font-size: 13px; color: var(--c-text-3);
  margin-bottom: 32px; letter-spacing: 0.01em;
  font-style: italic; font-family: var(--ff-display);
}

.lang-heading {
  font-size: 11px; text-transform: uppercase; letter-spacing: 0.1em;
  color: var(--c-green-400); font-weight: 600; margin-bottom: 14px;
  display: flex; align-items: center; gap: 8px;
}
.lang-heading::before, .lang-heading::after {
  content: ''; flex: 1; height: 1px;
  background: linear-gradient(90deg, transparent, rgba(45,138,68,0.35));
}
.lang-heading::after { transform: scaleX(-1); }

/* Language grid */
.lang-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-bottom: 28px;
}

.lang-btn {
  display: flex; flex-direction: column; align-items: center; gap: 6px;
  padding: 18px 10px 14px;
  background: rgba(255,255,255,0.04);
  border: 1.5px solid rgba(255,255,255,0.07);
  border-radius: 20px; cursor: pointer;
  transition: all 0.25s cubic-bezier(0.4,0,0.2,1);
  position: relative; overflow: hidden;
  font-family: var(--ff-body);
}
.lang-btn::after {
  content: '';
  position: absolute; inset: 0; border-radius: inherit;
  background: linear-gradient(135deg, rgba(45,138,68,0.15) 0%, transparent 60%);
  opacity: 0; transition: opacity 0.25s ease;
}
.lang-btn:hover {
  border-color: rgba(45,138,68,0.5);
  background: rgba(45,138,68,0.06);
  transform: translateY(-3px);
  box-shadow: 0 8px 24px rgba(45,138,68,0.15);
}
.lang-btn:hover::after { opacity: 1; }
.lang-btn.selected {
  border-color: var(--c-green-400);
  background: rgba(45,138,68,0.14);
  box-shadow: 0 0 0 3px rgba(45,138,68,0.18), 0 8px 24px rgba(45,138,68,0.2);
  transform: translateY(-3px);
}
.lang-btn.selected::after { opacity: 1; }
.lang-btn.selected .lang-check { opacity: 1; transform: scale(1); }

.lang-native {
  font-size: 22px; font-weight: 600; color: var(--c-text);
  line-height: 1; letter-spacing: -0.01em; position: relative; z-index: 1;
}
.lang-english {
  font-size: 10.5px; color: var(--c-text-3); font-weight: 400;
  letter-spacing: 0.04em; text-transform: uppercase; position: relative; z-index: 1;
}
.lang-check {
  position: absolute; top: 8px; right: 10px;
  width: 18px; height: 18px; border-radius: 50%;
  background: var(--c-green-500);
  display: grid; place-items: center;
  font-size: 10px; color: white;
  opacity: 0; transform: scale(0.5);
  transition: opacity 0.2s ease, transform 0.25s cubic-bezier(0.34,1.56,0.64,1);
}

/* API key input */
.api-key-wrap {
  margin-bottom: 20px;
}
.api-key-label {
  font-size: 10.5px; color: var(--c-text-3); letter-spacing: 0.06em;
  text-transform: uppercase; margin-bottom: 7px; display: flex; align-items: center; gap: 6px;
}
.api-key-label .tip {
  font-size: 10px; color: var(--c-green-500); text-transform: none; letter-spacing: 0;
}
.api-key-input {
  width: 100%; padding: 11px 14px;
  background: rgba(255,255,255,0.04);
  border: 1px solid var(--c-border);
  border-radius: 14px; color: var(--c-text);
  font-size: 13px; font-family: var(--ff-mono);
  outline: none; transition: var(--transition);
  letter-spacing: 0.04em;
}
.api-key-input::placeholder { color: var(--c-text-3); letter-spacing: 0; font-family: var(--ff-body); }
.api-key-input:focus { border-color: var(--c-green-500); background: rgba(255,255,255,0.06); box-shadow: 0 0 0 3px rgba(45,138,68,0.12); }

/* Enter button */
.lang-enter-btn {
  width: 100%; padding: 17px;
  border: none; border-radius: 20px;
  cursor: pointer; font-family: var(--ff-body);
  font-size: 15px; font-weight: 600;
  letter-spacing: 0.05em; text-transform: uppercase; color: #fff;
  background: linear-gradient(135deg, var(--c-green-500) 0%, var(--c-green-700) 100%);
  box-shadow: 0 8px 28px rgba(45,138,68,0.38), inset 0 1px 0 rgba(255,255,255,0.2);
  transition: var(--transition); position: relative; overflow: hidden;
}
.lang-enter-btn::before {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.14) 0%, transparent 60%);
}
.lang-enter-btn:hover { transform: translateY(-2px); box-shadow: 0 14px 36px rgba(45,138,68,0.48); }
.lang-enter-btn:disabled { opacity: 0.55; cursor: not-allowed; transform: none; }

/* Loading state inside button */
.btn-spinner {
  display: inline-block;
  width: 16px; height: 16px;
  border: 2px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  vertical-align: middle; margin-right: 8px;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* Status text under button */
.lang-status {
  text-align: center; margin-top: 14px;
  font-size: 12.5px; color: var(--c-text-3);
  font-family: var(--ff-mono); letter-spacing: 0.04em;
  min-height: 18px;
  transition: color 0.3s ease;
}
.lang-status.active { color: var(--c-green-400); }
.lang-status.error  { color: #f08080; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LANGUAGE CHANGE BANNER (top of app)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.lang-bar {
  position: relative; z-index: 100;
  display: flex; align-items: center; justify-content: flex-end;
  gap: 8px; padding: 6px 16px;
  background: rgba(45,138,68,0.07);
  border-bottom: 1px solid rgba(45,138,68,0.12);
}
.lang-bar-label { font-size: 11px; color: var(--c-text-3); font-family: var(--ff-mono); }
.lang-bar-btn {
  display: flex; align-items: center; gap: 5px;
  padding: 4px 12px; border-radius: var(--r-full);
  border: 1px solid rgba(45,138,68,0.3);
  background: rgba(45,138,68,0.1);
  color: var(--c-green-300); font-size: 11.5px; font-weight: 500;
  cursor: pointer; font-family: var(--ff-body);
  transition: var(--transition);
}
.lang-bar-btn:hover { background: rgba(45,138,68,0.2); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RADAR BANNER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.radar-banner {
  position: relative; z-index: 100;
  display: flex; align-items: center; gap: 10px; padding: 10px 20px;
  background: linear-gradient(90deg,rgba(201,168,76,0.12) 0%,rgba(45,138,68,0.08) 50%,rgba(201,168,76,0.06) 100%);
  border-bottom: 1px solid rgba(201,168,76,0.18);
  backdrop-filter: blur(12px);
  font-size: 12.5px; color: var(--c-gold-light);
  font-family: var(--ff-mono); letter-spacing: 0.01em;
}
.radar-banner b { color: var(--c-gold); font-weight: 500; }
.radar-pulse { position:relative;width:8px;height:8px;flex-shrink:0; }
.radar-pulse::before,.radar-pulse::after{content:'';position:absolute;inset:0;border-radius:50%;background:var(--c-amber);}
.radar-pulse::before{animation:pulseRing 2s ease-out infinite;}
.radar-pulse::after{transform:scale(0.65);}
@keyframes pulseRing{0%{transform:scale(1);opacity:0.8;}100%{transform:scale(3);opacity:0;}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.glass-nav {
  position: sticky; top: 0; z-index: 90;
  display: flex; align-items: center; justify-content: space-between;
  padding: 14px 24px;
  background: rgba(8,15,11,0.72);
  backdrop-filter: blur(24px) saturate(200%);
  -webkit-backdrop-filter: blur(24px) saturate(200%);
  border-bottom: 1px solid var(--c-border);
}
.nav-brand { display:flex;align-items:center;gap:10px;text-decoration:none;font-family:var(--ff-display);font-size:22px;font-weight:600;color:var(--c-text);letter-spacing:0.01em; }
.logo-icon { display:grid;place-items:center;width:34px;height:34px;background:linear-gradient(135deg,var(--c-green-700) 0%,var(--c-green-500) 100%);border-radius:10px;font-size:16px;box-shadow:0 4px 12px rgba(45,138,68,0.3),inset 0 1px 0 rgba(255,255,255,0.15); }
.nav-right { display:flex;align-items:center;gap:10px; }
.nav-link { display:flex;align-items:center;gap:6px;padding:7px 16px;border-radius:var(--r-full);text-decoration:none;font-size:13.5px;font-weight:500;color:var(--c-text-2);background:var(--c-surface-md);border:1px solid var(--c-border);transition:var(--transition);letter-spacing:0.01em; }
.nav-link:hover { color:var(--c-text);background:var(--c-surface-hi);border-color:var(--c-border-hi); }
.btn-back { display:none;align-items:center;gap:6px;padding:7px 14px;border-radius:var(--r-full);font-size:13px;font-weight:500;color:var(--c-text-2);background:var(--c-surface-md);border:1px solid var(--c-border);cursor:pointer;font-family:var(--ff-body);transition:var(--transition);letter-spacing:0.01em; }
.btn-back:hover { color:var(--c-text);background:var(--c-surface-hi);border-color:var(--c-border-hi); }
.btn-back.visible { display:flex; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
main { position:relative;z-index:10;max-width:1100px;margin:0 auto;padding:28px 16px 100px; }
/* Center the scanner card beautifully before analysis */
main:not(.two-col) #scanCard { 
  max-width: 600px; 
  margin: 0 auto; 
}

@media(min-width:760px) {
  main.two-col { 
    display: grid; 
    grid-template-columns: 1fr 1fr; 
    gap: 24px; 
    align-items: start; 
  }
  
  /* Stop the landing page elements from scattering into the grid */
  main.two-col > .hero-section,
  main.two-col > .features-section,
  main.two-col > .try-divider { 
    grid-column: 1 / -1; 
  }
}
@media(max-width:759px){main{padding:18px 12px 90px;}.card{padding:22px 18px;border-radius:28px;}.card-header h2{font-size:26px;}.chatbot-container{width:calc(100vw - 32px);right:16px;}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card { position:relative;background:rgba(255,255,255,0.035);backdrop-filter:blur(var(--glass-blur-lg)) saturate(180%);-webkit-backdrop-filter:blur(var(--glass-blur-lg)) saturate(180%);border:1px solid var(--c-border);border-radius:var(--r-xl);padding:28px 24px;box-shadow:var(--shadow-lg),var(--shadow-glow),inset 0 1px 0 rgba(255,255,255,0.06);overflow:hidden; }
.card::before{content:'';position:absolute;top:0;left:10%;right:10%;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.12) 30%,rgba(94,203,116,0.25) 50%,rgba(255,255,255,0.12) 70%,transparent);}
.slide-up{animation:slideUp 0.55s cubic-bezier(0.34,1.56,0.64,1) both;}
@keyframes slideUp{from{opacity:0;transform:translateY(32px) scale(0.97);}to{opacity:1;transform:translateY(0) scale(1);}}
.result-enter{animation:resultReveal 0.6s cubic-bezier(0.34,1.4,0.64,1) both;}
@keyframes resultReveal{from{opacity:0;transform:translateY(20px) scale(0.96);}to{opacity:1;transform:translateY(0) scale(1);}}

.card-header{margin-bottom:22px;}
.card-header h2{font-family:var(--ff-display);font-size:30px;font-weight:600;letter-spacing:-0.01em;color:var(--c-text);line-height:1.1;}
.card-header p{margin-top:4px;font-size:13.5px;color:var(--c-text-3);font-weight:400;letter-spacing:0.01em;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODE GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.mode-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:20px;}
.mode-btn{display:flex;flex-direction:column;align-items:center;gap:7px;padding:14px 8px;background:var(--c-surface-md);border:1px solid var(--c-border);border-radius:var(--r-md);cursor:pointer;color:var(--c-text-2);transition:var(--transition);font-family:var(--ff-body);position:relative;overflow:visible;}
.mode-btn[data-tip]:hover::after{content:attr(data-tip);position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%);background:rgba(10,20,13,0.96);border:1px solid var(--c-border-hi);color:var(--c-text-2);font-size:11px;white-space:nowrap;padding:5px 10px;border-radius:8px;pointer-events:none;z-index:50;backdrop-filter:blur(12px);box-shadow:0 4px 16px rgba(0,0,0,0.4);}
.mode-btn[data-tip]:hover::before{content:'';position:absolute;bottom:calc(100% + 3px);left:50%;transform:translateX(-50%);border:5px solid transparent;border-top-color:var(--c-border-hi);pointer-events:none;z-index:51;}
.mode-btn .bg-layer{position:absolute;inset:0;border-radius:inherit;background:linear-gradient(135deg,rgba(45,138,68,0.15) 0%,transparent 60%);opacity:0;transition:opacity var(--transition);}
.mode-btn:hover{border-color:var(--c-green-500);color:var(--c-text);box-shadow:0 4px 20px rgba(45,138,68,0.2);transform:translateY(-2px);}
.mode-btn:hover .bg-layer{opacity:1;}
.mode-btn.active{background:rgba(45,138,68,0.15);border-color:var(--c-green-400);color:var(--c-green-300);box-shadow:0 4px 20px rgba(45,138,68,0.25),inset 0 1px 0 rgba(94,203,116,0.2);}
.mode-btn.active .bg-layer{opacity:1;}
.mode-btn .emoji{font-size:22px;line-height:1;position:relative;z-index:1;filter:drop-shadow(0 2px 6px rgba(0,0,0,0.4));}
.mode-btn .label{font-size:11px;font-weight:500;letter-spacing:0.06em;text-transform:uppercase;position:relative;z-index:1;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VOICE BUTTON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn-voice{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:12px 18px;margin-bottom:16px;background:rgba(201,168,76,0.07);border:1px solid rgba(201,168,76,0.2);border-radius:var(--r-md);color:var(--c-gold-light);font-size:13.5px;font-weight:500;font-family:var(--ff-body);cursor:pointer;letter-spacing:0.02em;transition:var(--transition);}
.btn-voice .icon{font-size:16px;}
.btn-voice:hover{background:rgba(201,168,76,0.13);border-color:rgba(201,168,76,0.4);box-shadow:0 4px 20px rgba(201,168,76,0.12);transform:translateY(-1px);}
.btn-voice.listening{background:rgba(201,168,76,0.18);border-color:var(--c-gold);animation:voicePulse 1.2s ease-in-out infinite;}
@keyframes voicePulse{0%,100%{box-shadow:0 0 0 0 rgba(201,168,76,0.35);}50%{box-shadow:0 0 0 8px rgba(201,168,76,0);}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UPLOAD ZONE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.upload-zone{position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:240px;border-radius:var(--r-lg);border:1.5px dashed rgba(45,138,68,0.35);background:rgba(45,138,68,0.04);cursor:pointer;overflow:hidden;margin-bottom:10px;transition:var(--transition);}
.upload-zone:hover,.upload-zone.drag-over{border-color:rgba(45,138,68,0.75);background:rgba(45,138,68,0.09);box-shadow:0 0 50px rgba(45,138,68,0.08) inset;}
.upload-zone.drag-over{border-style:solid;}
#uploadContent{display:flex;flex-direction:column;align-items:center;gap:10px;padding:24px;text-align:center;pointer-events:none;}
.upload-icon{font-size:42px;line-height:1;filter:drop-shadow(0 4px 12px rgba(45,138,68,0.5));animation:iconBob 3.5s ease-in-out infinite;}
@keyframes iconBob{0%,100%{transform:translateY(0);}50%{transform:translateY(-6px);}}
#uploadContent h3{font-family:var(--ff-display);font-size:22px;font-weight:500;color:var(--c-text);}
#uploadContent p{font-size:12px;color:var(--c-text-3);letter-spacing:0.03em;}
.upload-hint{font-size:11px;color:var(--c-green-500);margin-top:2px;letter-spacing:0.04em;text-transform:uppercase;}
.preview-img{display:none;position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:var(--r-lg);}
.upload-actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px;}
.btn-upload-action{display:flex;align-items:center;justify-content:center;gap:7px;padding:10px;border-radius:var(--r-md);border:1px solid var(--c-border);background:var(--c-surface-md);color:var(--c-text-2);font-size:13px;font-weight:500;font-family:var(--ff-body);cursor:pointer;transition:var(--transition);letter-spacing:0.01em;}
.btn-upload-action:hover{border-color:var(--c-green-500);color:var(--c-green-300);background:rgba(45,138,68,0.07);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ERROR / PROGRESS / PRIMARY BTN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.error-box{display:none;align-items:flex-start;gap:12px;padding:16px;border-radius:var(--r-md);background:var(--c-error-bg);border:1px solid var(--c-error-border);color:#f0a0a0;font-size:13.5px;margin-bottom:14px;animation:slideUp 0.3s ease;}
.error-box.visible{display:flex;}
.error-box .icon{font-size:20px;flex-shrink:0;}
.error-title{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.06em;color:var(--c-error);margin-bottom:3px;}
.error-msg{font-size:13px;color:rgba(240,160,160,0.85);}
.error-dismiss{margin-left:auto;background:none;border:none;color:rgba(240,160,160,0.5);cursor:pointer;font-size:16px;padding:0 0 0 8px;transition:color var(--transition);flex-shrink:0;}
.error-dismiss:hover{color:rgba(240,160,160,0.9);}
.progress-wrap{display:none;flex-direction:column;gap:8px;margin-bottom:12px;}
.progress-wrap.visible{display:flex;}
.progress-label{font-size:12px;color:var(--c-text-3);font-family:var(--ff-mono);letter-spacing:0.04em;}
.progress-track{height:4px;border-radius:2px;background:rgba(255,255,255,0.06);overflow:hidden;}
.progress-bar{height:100%;width:0%;border-radius:2px;background:linear-gradient(90deg,var(--c-green-700),var(--c-green-300));transition:width 0.4s ease;box-shadow:0 0 8px rgba(94,203,116,0.5);}
.btn-primary{width:100%;padding:16px;border:none;border-radius:var(--r-md);cursor:pointer;font-family:var(--ff-body);font-size:15px;font-weight:600;letter-spacing:0.04em;text-transform:uppercase;color:#fff;background:linear-gradient(135deg,var(--c-green-500) 0%,var(--c-green-700) 100%);box-shadow:0 6px 24px rgba(45,138,68,0.35),inset 0 1px 0 rgba(255,255,255,0.2);transition:var(--transition);position:relative;overflow:hidden;}
.btn-primary::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,0.12) 0%,transparent 60%);}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 10px 32px rgba(45,138,68,0.45);}
.btn-primary:active{transform:translateY(0);}
.btn-primary:disabled{opacity:0.55;cursor:not-allowed;transform:none;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SKELETON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.skeleton-screen{display:none;flex-direction:column;gap:14px;padding:4px 0;}
.skeleton-screen.visible{display:flex;}
.skel{border-radius:12px;background:linear-gradient(90deg,rgba(255,255,255,0.04) 25%,rgba(255,255,255,0.09) 50%,rgba(255,255,255,0.04) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;}
@keyframes shimmer{0%{background-position:200% 0;}100%{background-position:-200% 0;}}
.skel-row{height:18px;}.skel-half{width:60%;height:18px;}.skel-block{height:90px;}.skel-short{width:40%;height:14px;}.skel-metric{height:120px;border-radius:14px;}.skel-metrics{display:grid;grid-template-columns:1fr 1fr;gap:12px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESULT HEADER + BADGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.result-header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:22px;gap:12px;}
.result-header h2{font-family:var(--ff-display);font-size:28px;font-weight:600;color:var(--c-text);}
.badge-success{display:inline-flex;align-items:center;gap:4px;margin-top:6px;padding:3px 10px;border-radius:var(--r-full);background:rgba(45,138,68,0.18);border:1px solid rgba(45,138,68,0.35);font-size:11px;font-weight:500;color:var(--c-green-300);letter-spacing:0.04em;text-transform:uppercase;}
.badge-success::before{content:'';width:5px;height:5px;border-radius:50%;background:var(--c-green-300);box-shadow:0 0 6px var(--c-green-400);animation:blink 2s ease-in-out infinite;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:0.3;}}
.btn-icon{display:grid;place-items:center;width:38px;height:38px;border-radius:50%;border:1px solid var(--c-border);background:var(--c-surface-md);cursor:pointer;font-size:16px;color:var(--c-text-2);transition:var(--transition);flex-shrink:0;}
.btn-icon:hover{background:var(--c-surface-hi);border-color:var(--c-border-hi);color:var(--c-text);transform:rotate(15deg);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   METRICS RINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.metrics-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px;}
.metric-box{display:flex;flex-direction:column;align-items:center;gap:10px;padding:18px 14px;background:var(--c-surface-md);border:1px solid var(--c-border);border-radius:var(--r-md);text-align:center;position:relative;overflow:hidden;}
.metric-box::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--c-green-700),var(--c-green-400),var(--c-green-700));}
.ring-wrap{position:relative;width:72px;height:72px;}
.ring-wrap svg{transform:rotate(-90deg);}
.ring-bg{fill:none;stroke:rgba(255,255,255,0.06);stroke-width:5;}
.ring-fill{fill:none;stroke:var(--c-green-400);stroke-width:5;stroke-linecap:round;stroke-dasharray:176;stroke-dashoffset:176;transition:stroke-dashoffset 1.2s cubic-bezier(0.4,0,0.2,1);}
.ring-fill.roi-ring{stroke:var(--c-gold);}
.ring-val{position:absolute;inset:0;display:grid;place-items:center;font-family:var(--ff-mono);font-size:13px;font-weight:500;color:var(--c-green-300);}
.ring-val.roi-val{color:var(--c-gold-light);}
.metric-label{font-size:11px;color:var(--c-text-3);font-weight:400;letter-spacing:0.04em;text-transform:uppercase;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DIAGNOSIS CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.result-body{padding:0;margin-bottom:16px;}
.diagnosis-cards{display:flex;flex-direction:column;gap:10px;}
.diag-card{display:flex;align-items:flex-start;gap:14px;padding:14px 16px;background:rgba(0,0,0,0.2);border:1px solid rgba(255,255,255,0.06);border-radius:var(--r-md);transition:var(--transition);opacity:0;transform:translateX(-10px);animation:cardIn 0.4s ease forwards;}
.diag-card:nth-child(1){animation-delay:0.05s;}.diag-card:nth-child(2){animation-delay:0.15s;}.diag-card:nth-child(3){animation-delay:0.25s;}
@keyframes cardIn{to{opacity:1;transform:translateX(0);}}
.diag-card:hover{background:rgba(45,138,68,0.06);border-color:rgba(45,138,68,0.22);}
.diag-icon{font-size:22px;flex-shrink:0;width:36px;text-align:center;padding-top:2px;}
.diag-info{flex:1;min-width:0;}
.diag-label{font-size:10.5px;text-transform:uppercase;letter-spacing:0.06em;color:var(--c-text-3);margin-bottom:3px;}
.diag-value{font-size:14.5px;font-weight:500;color:var(--c-text);word-break:break-word;line-height:1.4;}
.severity-bar-wrap{margin-top:8px;}
.severity-bar-track{height:3px;border-radius:2px;background:rgba(255,255,255,0.07);overflow:hidden;}
.severity-bar-fill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--c-green-500),var(--c-amber),var(--c-error));transition:width 1s cubic-bezier(0.4,0,0.2,1);width:0%;}
.empty-state{display:none;flex-direction:column;align-items:center;gap:10px;padding:32px 16px;text-align:center;}
.empty-state.visible{display:flex;}
.empty-icon{font-size:40px;}
.empty-state h4{font-family:var(--ff-display);font-size:22px;color:var(--c-text-2);}
.empty-state p{font-size:13px;color:var(--c-text-3);max-width:240px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INFO BOXES / ACTION BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.info-box{display:flex;align-items:flex-start;gap:12px;padding:14px 16px;border-radius:var(--r-md);margin-bottom:12px;font-size:13.5px;}
.info-box .icon{font-size:18px;flex-shrink:0;margin-top:1px;}
.info-box b{display:block;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.06em;margin-bottom:2px;}
.info-box.warning{background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.2);color:var(--c-gold-light);}
.info-box.warning b{color:var(--c-gold);}
.info-box.info{background:rgba(45,138,68,0.06);border:1px solid rgba(45,138,68,0.18);color:var(--c-text-2);}
.info-box.info b{color:var(--c-green-300);}
.action-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px;}
.btn-outline{padding:12px;border-radius:var(--r-md);border:1px solid var(--c-border);background:var(--c-surface-md);color:var(--c-text-2);font-size:13px;font-weight:500;font-family:var(--ff-body);cursor:pointer;transition:var(--transition);letter-spacing:0.01em;}
.btn-outline:hover{background:var(--c-surface-hi);border-color:var(--c-green-500);color:var(--c-green-300);box-shadow:0 4px 16px rgba(45,138,68,0.15);transform:translateY(-2px);}
.btn-secondary{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:13px;border-radius:var(--r-md);background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.22);color:var(--c-gold-light);font-size:13.5px;font-weight:500;font-family:var(--ff-body);text-decoration:none;letter-spacing:0.02em;transition:var(--transition);}
.btn-secondary:hover{background:rgba(201,168,76,0.14);border-color:rgba(201,168,76,0.40);box-shadow:0 4px 20px rgba(201,168,76,0.12);transform:translateY(-1px);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FAB + CHAT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.fab-chat {
  position: fixed !important;
  bottom: 28px !important;
  right: 24px !important;
  z-index: 9999 !important; /* Forces it above all other elements */
  width: 58px;
  height: 58px;
  border-radius: 50%;
  border: 1px solid rgba(45,138,68,0.4);
  background: linear-gradient(135deg, var(--c-green-700) 0%, var(--c-green-900) 100%);
  box-shadow: 0 8px 28px rgba(0,0,0,0.5), 0 0 30px rgba(45,138,68,0.2);
  color: var(--c-green-100);
  font-size: 22px;
  cursor: pointer;
  display: grid;
  place-items: center;
  transition: var(--transition);}
.fab-chat:hover{transform:scale(1.08) translateY(-2px);}
.chatbot-container{display:none;flex-direction:column;position:fixed;bottom:96px;right:20px;z-index:199;width:340px;max-height:460px;border-radius:var(--r-xl);border:1px solid var(--c-border-hi);background:rgba(10,20,13,0.88);backdrop-filter:blur(32px) saturate(200%);-webkit-backdrop-filter:blur(32px) saturate(200%);box-shadow:var(--shadow-lg),var(--shadow-glow);overflow:hidden;animation:chatOpen 0.3s cubic-bezier(0.34,1.56,0.64,1) both;}
@keyframes chatOpen{from{opacity:0;transform:scale(0.9) translateY(16px);transform-origin:bottom right;}to{opacity:1;transform:scale(1) translateY(0);}}
.chat-header{display:flex;align-items:center;gap:10px;padding:14px 18px;border-bottom:1px solid var(--c-border);background:rgba(255,255,255,0.03);}
.chat-header span{flex:1;font-family:var(--ff-display);font-size:17px;font-weight:600;letter-spacing:0.01em;color:var(--c-text);}
.status-dot{width:8px;height:8px;border-radius:50%;background:var(--c-green-400);box-shadow:0 0 8px var(--c-green-400);animation:blink 2s ease-in-out infinite;}
.close-chat{width:28px;height:28px;border-radius:50%;border:1px solid var(--c-border);background:var(--c-surface-md);color:var(--c-text-3);font-size:16px;cursor:pointer;display:grid;place-items:center;transition:var(--transition);}
.close-chat:hover{color:var(--c-text);background:var(--c-surface-hi);}
.chat-messages{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:10px;scrollbar-width:thin;scrollbar-color:var(--c-border) transparent;}
.msg{max-width:82%;padding:10px 14px;border-radius:16px;font-size:13.5px;line-height:1.5;}
.msg.bot{align-self:flex-start;background:rgba(45,138,68,0.12);border:1px solid rgba(45,138,68,0.2);border-bottom-left-radius:4px;color:var(--c-text-2);}
.msg.user{align-self:flex-end;background:rgba(255,255,255,0.07);border:1px solid var(--c-border);border-bottom-right-radius:4px;color:var(--c-text);}
.msg.typing{display:flex;align-items:center;gap:5px;padding:14px 16px;}
.typing-dot{width:7px;height:7px;border-radius:50%;background:var(--c-green-400);animation:typingBounce 1.2s ease-in-out infinite;}
.typing-dot:nth-child(2){animation-delay:0.2s;}.typing-dot:nth-child(3){animation-delay:0.4s;}
@keyframes typingBounce{0%,80%,100%{transform:translateY(0);opacity:0.5;}40%{transform:translateY(-6px);opacity:1;}}
.chat-input-area{display:flex;gap:8px;padding:12px 14px;border-top:1px solid var(--c-border);background:rgba(0,0,0,0.2);}
.chat-input-area input{flex:1;padding:10px 14px;background:rgba(255,255,255,0.05);border:1px solid var(--c-border);border-radius:var(--r-full);color:var(--c-text);font-size:13.5px;font-family:var(--ff-body);outline:none;transition:var(--transition);}
.chat-input-area input::placeholder{color:var(--c-text-3);}
.chat-input-area input:focus{border-color:var(--c-green-500);background:rgba(255,255,255,0.07);box-shadow:0 0 0 3px rgba(45,138,68,0.12);}
.btn-send{width:40px;height:40px;border-radius:50%;border:none;background:linear-gradient(135deg,var(--c-green-500),var(--c-green-700));color:white;font-size:14px;cursor:pointer;display:grid;place-items:center;flex-shrink:0;box-shadow:0 4px 12px rgba(45,138,68,0.3);transition:var(--transition);}
.btn-send:hover{transform:scale(1.08);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-backdrop{display:none;position:fixed;inset:0;z-index:300;background:rgba(0,0,0,0.65);backdrop-filter:blur(8px);align-items:flex-end;justify-content:center;padding:20px;padding-bottom:32px;animation:fadeIn 0.2s ease;}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
.modal-card{width:100%;max-width:480px;background:rgba(12,22,15,0.96);backdrop-filter:blur(40px);border:1px solid var(--c-border-hi);border-radius:var(--r-xl);padding:28px 24px;box-shadow:var(--shadow-lg);animation:modalSlide 0.35s cubic-bezier(0.34,1.56,0.64,1) both;position:relative;overflow:hidden;}
.modal-card::before{content:'';position:absolute;top:0;left:10%;right:10%;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.12),transparent);}
@keyframes modalSlide{from{transform:translateY(40px) scale(0.96);opacity:0;}to{transform:translateY(0) scale(1);opacity:1;}}
.modal-card h3{font-family:var(--ff-display);font-size:24px;font-weight:600;margin-bottom:20px;color:var(--c-text);}
.list-group{display:flex;flex-direction:column;gap:10px;margin-bottom:18px;}
.list-item{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:var(--c-surface-md);border:1px solid var(--c-border);border-radius:var(--r-md);gap:12px;transition:var(--transition);}
.list-item:hover{border-color:var(--c-green-500);background:rgba(45,138,68,0.07);}
.item-info{display:flex;flex-direction:column;gap:3px;}
.item-info b{font-size:14px;font-weight:600;color:var(--c-text);}
.item-info span{font-size:12px;color:var(--c-text-3);}
.btn-sm{padding:8px 16px;border-radius:var(--r-full);border:1px solid var(--c-green-500);background:rgba(45,138,68,0.12);color:var(--c-green-300);font-size:12px;font-weight:600;font-family:var(--ff-body);cursor:pointer;letter-spacing:0.04em;transition:var(--transition);white-space:nowrap;}
.btn-sm:hover{background:rgba(45,138,68,0.25);}
.btn-text{display:block;width:100%;padding:10px;border:none;background:none;color:var(--c-text-3);font-size:13.5px;font-family:var(--ff-body);cursor:pointer;text-align:center;transition:color var(--transition);}
.btn-text:hover{color:var(--c-text-2);}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HERO LANDING SECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero-section {
  position: relative;
  padding: 80px 24px 60px;
  text-align: center;
  max-width: 860px;
  margin: 0 auto;
  z-index: 2;
}
.hero-badge {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 6px 16px; border-radius: 999px;
  background: rgba(45,138,68,0.15); border: 1px solid rgba(45,138,68,0.35);
  font-size: 11.5px; font-weight: 600; letter-spacing: 0.08em;
  text-transform: uppercase; color: var(--c-green-300);
  margin-bottom: 28px;
  animation: slideUp 0.6s cubic-bezier(0.34,1.56,0.64,1) both;
}
.hero-badge .dot { width:6px; height:6px; border-radius:50%; background:var(--c-green-400); box-shadow:0 0 8px var(--c-green-400); animation:blink 2s infinite; }
.hero-title {
  font-family: var(--ff-display);
  font-size: clamp(42px, 8vw, 78px);
  font-weight: 700; line-height: 1.05;
  color: var(--c-text); letter-spacing: -0.02em;
  margin-bottom: 12px;
  animation: slideUp 0.7s cubic-bezier(0.34,1.56,0.64,1) 0.1s both;
}
.hero-title .green { color: var(--c-green-400); }
.hero-subtitle-team {
  font-size: 13px; color: var(--c-green-500); font-weight: 600;
  letter-spacing: 0.12em; text-transform: uppercase;
  margin-bottom: 20px;
  animation: slideUp 0.7s ease 0.15s both;
}
.hero-desc {
  font-size: 16.5px; color: var(--c-text-2); line-height: 1.75;
  max-width: 620px; margin: 0 auto 40px;
  animation: slideUp 0.7s ease 0.2s both;
}
.hero-stats {
  display: flex; justify-content: center; gap: 40px; flex-wrap: wrap;
  margin-bottom: 52px;
  animation: slideUp 0.7s ease 0.25s both;
}
.hero-stat { text-align: center; }
.hero-stat-val {
  font-family: var(--ff-display); font-size: 32px; font-weight: 700;
  color: var(--c-green-300); line-height: 1;
}
.hero-stat-label { font-size: 11px; color: var(--c-text-3); text-transform: uppercase; letter-spacing: 0.08em; margin-top: 4px; }

/* â•â•â• FEATURES SECTION â•â•â• */
.features-section {
  max-width: 960px; margin: 0 auto;
  padding: 0 20px 60px;
  scroll-margin-top: 100px; /* <--- This forces it to stop right above the heading! */
}
.features-heading {
  text-align: center; margin-bottom: 36px;
}
.features-heading h2 {
  font-family: var(--ff-display); font-size: 36px; font-weight: 600;
  color: var(--c-text); margin-bottom: 8px;
}
.features-heading p { font-size: 14px; color: var(--c-text-3); }

.features-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 16px; margin-bottom: 16px;
}
.feat-card {
  background: rgba(255,255,255,0.035);
  border: 1px solid var(--c-border);
  border-radius: 24px; padding: 28px 22px;
  backdrop-filter: blur(20px);
  transition: var(--transition);
  position: relative; overflow: hidden;
}
.feat-card::before {
  content: ''; position: absolute; top:0; left:15%; right:15%; height:1px;
  background: linear-gradient(90deg, transparent, rgba(94,203,116,0.3), transparent);
}
.feat-card:hover {
  border-color: rgba(45,138,68,0.45);
  transform: translateY(-4px);
  box-shadow: 0 16px 40px rgba(0,0,0,0.4), 0 0 30px rgba(45,138,68,0.08);
}
.feat-icon { font-size: 32px; margin-bottom: 14px; line-height:1; }
.feat-title { font-family: var(--ff-display); font-size: 20px; font-weight: 600; color: var(--c-text); margin-bottom: 8px; }
.feat-desc { font-size: 13px; color: var(--c-text-2); line-height: 1.65; }
.feat-tag {
  display: inline-block; margin-top: 12px;
  padding: 3px 10px; border-radius: 999px;
  background: rgba(45,138,68,0.12); border: 1px solid rgba(45,138,68,0.25);
  font-size: 10.5px; font-weight: 600; color: var(--c-green-400);
  letter-spacing: 0.06em; text-transform: uppercase;
}

/* â•â•â• TRY IT CTA DIVIDER â•â•â• */
.try-divider {
  text-align: center; padding: 48px 20px 36px;
  position: relative;
}
.try-divider::before {
  content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%);
  width: 1px; height: 48px;
  background: linear-gradient(to bottom, transparent, rgba(45,138,68,0.5), transparent);
}
.try-divider h3 {
  font-family: var(--ff-display); font-size: 28px; font-weight: 600;
  color: var(--c-text); margin-bottom: 8px;
}
.try-divider p { font-size: 13.5px; color: var(--c-text-3); margin-bottom: 20px; }
.try-arrow {
  display: inline-block;
  font-size: 28px;
  animation: bounceDown 1.6s ease-in-out infinite;
  color: var(--c-green-400);
}
@keyframes bounceDown {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(10px); }
}

/* â•â•â• FOOTER â•â•â• */
.agri-footer {
  text-align: center;
  padding: 36px 20px 28px;
  border-top: 1px solid var(--c-border);
  margin-top: 48px;
}
.footer-hacknovation {
  font-family: var(--ff-display);
  font-size: 15px; color: var(--c-text-3);
  letter-spacing: 0.04em;
}
.footer-hacknovation span { color: var(--c-green-400); font-weight: 600; }
.footer-team {
  font-size: 12px; color: var(--c-text-3);
  margin-top: 6px; letter-spacing: 0.06em; text-transform: uppercase;
}

/* â•â•â• HERO SCROLL BUTTON â•â•â• */
.hero-scroll-btn {
  display: inline-flex; 
  align-items: center; 
  justify-content: center;
  width: 54px; 
  height: 54px; 
  margin-top: 20px;
  border-radius: 50%;
  background: rgba(255,255,255,0.03);
  backdrop-filter: blur(10px);
  border: 1px solid var(--c-border);
  color: var(--c-green-400); 
  font-size: 22px;
  text-decoration: none; 
  transition: var(--transition);
  animation: bounceFloat 2.5s ease-in-out infinite, slideUp 0.7s ease 0.3s both;
  box-shadow: 0 8px 24px rgba(0,0,0,0.4);
  z-index: 10;
}

.hero-scroll-btn:hover {
  background: rgba(45,138,68,0.12);
  border-color: var(--c-green-500); 
  color: var(--c-green-300);
  box-shadow: 0 8px 28px rgba(45,138,68,0.3);
}

@keyframes bounceFloat {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(12px); }
}

</style> </head>
<body>

<!-- â•â•â• BACKGROUND ORBS â•â•â• -->
<div class="orb orb-1"></div>
<div class="orb orb-2"></div>
<div class="orb orb-3"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LANGUAGE SELECTOR OVERLAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="langOverlay">
  <div class="lang-card">
    <div class="lang-card-glow"></div>

    <div class="lang-brand">
      <div class="lang-logo">ğŸŒ¿</div>
      <div class="lang-brand-name">AgriUstaad</div>
    </div>
    <div class="lang-tagline">by Team AgriCore Â· Your intelligent farming companion</div>

    <div class="lang-heading">Select Your Language</div>

    <div class="lang-grid">
      <button class="lang-btn selected" data-lang="en" data-name="English" onclick="selectLang(this)">
        <div class="lang-check">âœ“</div>
        <div class="lang-native">English</div>
        <div class="lang-english">English</div>
      </button>
      <button class="lang-btn" data-lang="hi" data-name="Hindi" onclick="selectLang(this)">
        <div class="lang-check">âœ“</div>
        <div class="lang-native">à¤¹à¤¿à¤‚à¤¦à¥€</div>
        <div class="lang-english">Hindi</div>
      </button>
      <button class="lang-btn" data-lang="or" data-name="Odia" onclick="selectLang(this)">
        <div class="lang-check">âœ“</div>
        <div class="lang-native">à¬“à¬¡à¬¼à¬¿à¬†</div>
        <div class="lang-english">Odia</div>
      </button>
      <button class="lang-btn" data-lang="te" data-name="Telugu" onclick="selectLang(this)">
        <div class="lang-check">âœ“</div>
        <div class="lang-native">à°¤à±†à°²à±à°—à±</div>
        <div class="lang-english">Telugu</div>
      </button>
      <button class="lang-btn" data-lang="ta" data-name="Tamil" onclick="selectLang(this)">
        <div class="lang-check">âœ“</div>
        <div class="lang-native">à®¤à®®à®¿à®´à¯</div>
        <div class="lang-english">Tamil</div>
      </button>
      <button class="lang-btn" data-lang="pa" data-name="Punjabi" onclick="selectLang(this)">
        <div class="lang-check">âœ“</div>
        <div class="lang-native">à¨ªà©°à¨œà¨¾à¨¬à©€</div>
        <div class="lang-english">Punjabi</div>
      </button>
    </div>


    <button class="lang-enter-btn" id="enterBtn" onclick="enterApp()">
      Enter AgriUstaad â†’
    </button>
    <div class="lang-status" id="langStatus"></div>
  </div>
</div>

<!-- â•â•â• FLASH OVERLAY â•â•â• -->
<div id="flashOverlay"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN APP (blurred behind language screen)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="appWrapper">

  <!-- Language change bar (shown after lang is set) -->
  <div class="lang-bar" id="langBar" style="display:none;">
    <span class="lang-bar-label" data-i18n="langBarLabel">Language:</span>
    <button class="lang-bar-btn" id="langBarBtn" onclick="resetLanguage()">
      ğŸŒ <span id="langBarName">English</span> Â· Change
    </button>
  </div>

  <div class="radar-banner">
    <div class="radar-pulse"></div>
    <span data-i18n="radarBanner"><b>Community Radar:</b> 3 cases of "Leaf Blast" detected within 5km today.</span>
  </div>

  <nav class="glass-nav">
    <a class="nav-brand" href="/">
      <span class="logo-icon">ğŸŒ¿</span>
      AgriUstaad
    </a>
    <div class="nav-right">
      <button class="btn-back" id="btnBack" onclick="goBack()">â† <span data-i18n="back">Back</span></button>
      <a href="/history" class="nav-link"><span>ğŸ—ºï¸</span> <span data-i18n="map">Map</span></a>
    </div>
  </nav>

  <main id="mainGrid">

    <!-- â•â•â•â• HERO LANDING SECTION â•â•â•â• -->
    <div class="hero-section" id="heroSection">
      <div class="hero-badge"><span class="dot"></span> Hacknovation 2.0 Â· Team AgriCore</div>
      <h1 class="hero-title">Agri<span class="green">Ustaad</span></h1>
      <div class="hero-subtitle-team">by Team AgriCore</div>
      <p class="hero-desc">
        An AI-powered super app for Indian farmers â€” diagnose crop diseases, estimate yields, analyse soil health, and get real-time advisory in your own language. Built for the field, by people who care about it.
      </p>
      <div class="hero-stats">
        <div class="hero-stat">
          <div class="hero-stat-val">5+</div>
          <div class="hero-stat-label">Languages</div>
        </div>
        <div class="hero-stat">
          <div class="hero-stat-val">4</div>
          <div class="hero-stat-label">AI Scan Modes</div>
        </div>
        <div class="hero-stat">
          <div class="hero-stat-val">Real-time</div>
          <div class="hero-stat-label">Weather Advisory</div>
        </div>
        <div class="hero-stat">
          <div class="hero-stat-val">Free</div>
          <div class="hero-stat-label">For Every Farmer</div>
        </div>
      </div>

      <a href="#featuresSection" class="hero-scroll-btn" title="Scroll Down">â†“</a>
      
    </div>

    <!-- â•â•â•â• FEATURES SECTION â•â•â•â• -->
    <div class="features-section" id="featuresSection">
      <div class="features-heading">
        <h2>What AgriUstaad Can Do</h2>
        <p>Powerful AI tools designed for real farm conditions</p>
      </div>
      <div class="features-grid">
        <div class="feat-card">
          <div class="feat-icon">ğŸŒ¿</div>
          <div class="feat-title">Disease Detection</div>
          <div class="feat-desc">Photograph any crop and get an instant AI diagnosis â€” disease name, severity score, and treatment advice in seconds.</div>
          <span class="feat-tag">AI Vision</span>
        </div>
        <div class="feat-card">
          <div class="feat-icon">ğŸ‡</div>
          <div class="feat-title">Yield Estimator</div>
          <div class="feat-desc">Know your harvest readiness and get smart market advice before you cut â€” so you sell at the right time, at the right price.</div>
          <span class="feat-tag">Harvest AI</span>
        </div>
        <div class="feat-card">
          <div class="feat-icon">ğŸŸ¤</div>
          <div class="feat-title">Soil Analysis</div>
          <div class="feat-desc">Understand your soil type, moisture levels, and get personalised treatment plans to improve your field's health.</div>
          <span class="feat-tag">Soil Intel</span>
        </div>
        <div class="feat-card">
          <div class="feat-icon">ğŸ“¦</div>
          <div class="feat-title">Crate Inspector</div>
          <div class="feat-desc">Scan produce crates for quality grading â€” perfect for supply chain decisions and post-harvest management.</div>
          <span class="feat-tag">Quality AI</span>
        </div>
        <div class="feat-card">
          <div class="feat-icon">ğŸŒ¤ï¸</div>
          <div class="feat-title">Weather Advisory</div>
          <div class="feat-desc">Hyperlocal weather insights tied to your GPS location, with actionable farming guidance for the week ahead.</div>
          <span class="feat-tag">Live Data</span>
        </div>
        <div class="feat-card">
          <div class="feat-icon">ğŸ¤–</div>
          <div class="feat-title">Agronomist AI Chat</div>
          <div class="feat-desc">Ask anything, anytime. Your AI agronomist is available 24/7 to answer questions about crops, pests, and farming practices.</div>
          <span class="feat-tag">Always On</span>
        </div>
      </div>
    </div>

    <!-- â•â•â•â• TRY IT DIVIDER â•â•â•â• -->
    <div class="try-divider">
      <h3>Ready to Scan Your Field?</h3>
      <p>Pick a mode below and upload a photo â€” results in under 10 seconds</p>
      <div class="try-arrow">â†“</div>
    </div>

    <!-- â•â•â•â• SCAN CARD â•â•â•â• -->
    <section class="card slide-up" id="scanCard">
      <div class="card-header">
        <h2 data-i18n="scanTitle">AI Field Scanner</h2>
        <p data-i18n="scanSubtitle">Select a tool to begin analysis</p>
      </div>

      <div class="mode-grid">
        <button class="mode-btn active" onclick="setMode('field',this)" data-tip-key="tipDisease">
          <div class="bg-layer"></div>
          <span class="emoji">ğŸŒ¿</span><span class="label" data-i18n="modeDisease">Disease</span>
        </button>
        <button class="mode-btn" onclick="setMode('yield',this)" data-tip-key="tipYield">
          <div class="bg-layer"></div>
          <span class="emoji">ğŸ‡</span><span class="label" data-i18n="modeYield">Yield</span>
        </button>
        <button class="mode-btn" onclick="setMode('soil',this)" data-tip-key="tipSoil">
          <div class="bg-layer"></div>
          <span class="emoji">ğŸŸ¤</span><span class="label" data-i18n="modeSoil">Soil</span>
        </button>
        <button class="mode-btn" onclick="setMode('crate',this)" data-tip-key="tipCrate">
          <div class="bg-layer"></div>
          <span class="emoji">ğŸ“¦</span><span class="label" data-i18n="modeCrate">Crate</span>
        </button>
      </div>

      <button class="btn-voice" id="voiceBtn" onclick="startVoiceScan()">
        <span class="icon">ğŸ¤</span> <span data-i18n="voiceCmd">Voice Command</span>
      </button>

      <div class="upload-zone" id="uploadZone"
           onclick="document.getElementById('fileIn').click()"
           ondragover="handleDragOver(event)"
           ondragleave="handleDragLeave(event)"
           ondrop="handleDrop(event)">
        <input type="file" id="fileIn" hidden accept="image/*" onchange="previewFile(this.files[0])">
        <input type="file" id="cameraIn" hidden accept="image/*" capture="environment" onchange="previewFile(this.files[0])">
        <div id="uploadContent">
          <div class="upload-icon">ğŸ“¸</div>
          <h3 data-i18n="uploadTitle">Drag & Drop or Tap</h3>
          <p data-i18n="uploadSub">Supports JPG, PNG Â· AI Analysis</p>
          <span class="upload-hint" data-i18n="uploadHint">â†‘ Drop image here â†‘</span>
        </div>
        <img id="preview" class="preview-img" alt="Field preview" />
      </div>

      <div class="upload-actions">
        <button class="btn-upload-action" onclick="event.stopPropagation();document.getElementById('fileIn').click()">ğŸ–¼ï¸ <span data-i18n="gallery">Gallery</span></button>
        <button class="btn-upload-action" onclick="event.stopPropagation();document.getElementById('cameraIn').click()">ğŸ“· <span data-i18n="camera">Camera</span></button>
      </div>

      <div class="error-box" id="scanError">
        <span class="icon">âš ï¸</span>
        <div>
          <div class="error-title" data-i18n="errTitle">Analysis Failed</div>
          <div class="error-msg" id="scanErrorMsg">Something went wrong.</div>
        </div>
        <button class="error-dismiss" onclick="dismissError('scanError')">âœ•</button>
      </div>

      <div class="progress-wrap" id="progressWrap">
        <div class="progress-label" id="progressLabel" data-i18n="uploading">Uploading imageâ€¦</div>
        <div class="progress-track"><div class="progress-bar" id="progressBar"></div></div>
      </div>

      <input type="hidden" id="lat" value="20.296">
      <input type="hidden" id="lon" value="85.824">

      <button class="btn-primary" id="btnAnalyze" onclick="runAnalysis()">
        ğŸš€ &nbsp;<span data-i18n="runAnalysis">Run Analysis</span>
      </button>
    </section>

    <!-- â•â•â•â• RESULT CARD â•â•â•â• -->
    <section class="card" id="resultCard" style="display:none;">
      
      <div class="skeleton-screen" id="skelScreen">
        <div class="result-header" style="margin-bottom: 8px;">
          <div>
            <h2 style="color: var(--c-text-2);">AI is Analyzing...</h2>
            <div class="skel" style="width: 110px; height: 16px; margin-top: 8px; border-radius: 20px;"></div>
          </div>
          <div class="skel" style="width: 38px; height: 38px; border-radius: 50%;"></div>
        </div>
        <div class="skel-metrics"><div class="skel skel-metric"></div><div class="skel skel-metric"></div></div>
        <div class="skel skel-row"></div><div class="skel skel-block"></div>
        <div class="skel skel-half"></div><div class="skel skel-short"></div>
      </div>

      <div id="resultContent" style="display:none;">
        <div class="result-header">
          <div>
            <h2 data-i18n="diagTitle">Diagnosis Complete</h2>
            <span class="badge-success" data-i18n="aiVerified">AI Verified</span>
          </div>
          <button onclick="location.reload()" class="btn-icon" title="New scan">ğŸ”„</button>
        </div>
        <div class="metrics-grid" id="metricsRow">
          <div class="metric-box">
            <div class="ring-wrap">
              <svg width="72" height="72" viewBox="0 0 72 72" style="transform:rotate(-90deg)">
                <circle class="ring-bg" cx="36" cy="36" r="28"/>
                <circle class="ring-fill" cx="36" cy="36" r="28" id="ecoRing" style="stroke-dasharray:176;stroke-dashoffset:176;"/>
              </svg>
              <div class="ring-val" id="scoreEco">--</div>
            </div>
            <span class="metric-label" data-i18n="ecoScore">Eco Score ğŸŒ</span>
          </div>
          <div class="metric-box">
            <div class="ring-wrap">
              <svg width="72" height="72" viewBox="0 0 72 72" style="transform:rotate(-90deg)">
                <circle class="ring-bg" cx="36" cy="36" r="28"/>
                <circle class="ring-fill roi-ring" cx="36" cy="36" r="28" id="roiRing" style="stroke-dasharray:176;stroke-dashoffset:176;"/>
              </svg>
              <div class="ring-val roi-val" id="scoreRoi">--</div>
            </div>
            <span class="metric-label" data-i18n="roiEst">ROI Est. ğŸ’°</span>
          </div>
        </div>

        <div class="result-body" id="resBody">
          <div class="diagnosis-cards" id="diagCards"></div>
          <div class="empty-state" id="emptyState">
            <div class="empty-icon">ğŸ”</div>
            <h4 data-i18n="emptyTitle">No Data Returned</h4>
            <p data-i18n="emptyDesc">The analysis didn't return usable results. Try with a clearer image.</p>
          </div>
        </div>

        <div class="info-box warning" id="subsidyBox" style="display:none; align-items: center; justify-content: space-between; gap: 15px;">
          <div style="display: flex; gap: 12px; align-items: flex-start;">
            <span class="icon">ğŸ›ï¸</span>
            <div><b data-i18n="govtScheme">Govt Scheme</b><span id="subsidyName"></span></div>
          </div>
          <a id="schemeLink" href="#" target="_blank" class="btn-sm" 
            style="background: var(--c-gold); color: #080f0b; border: none; text-decoration: none; display: none; font-weight: 700; padding: 8px 14px; border-radius: 99px; font-size: 11px; flex-shrink: 0; box-shadow: 0 4px 12px rgba(201, 168, 76, 0.3);">
            KNOW MORE
          </a>
        </div>

        <div class="info-box info" id="weatherBox">
          <span class="icon">ğŸŒ¤ï¸</span>
          <div><b data-i18n="weatherAdv">Weather Advisory</b><span id="weatherText">Checkingâ€¦</span></div>
        </div>

        <div class="action-grid" id="marketGrid">
          <button class="btn-outline" onclick="openModal('sprayer')" data-i18n="rentTool">ğŸšœ Rent Tool</button>
          <button class="btn-outline" onclick="openModal('shop')" data-i18n="buyMeds">ğŸ’Š Buy Meds</button>
        </div>

        <a id="pdfLink" href="#" target="_blank" class="btn-secondary" data-i18n="downloadPdf">
          ğŸ“„ &nbsp;Download Health Passport (PDF)
        </a>

        <button class="btn-primary" onclick="shareReport()" style="margin-top: 12px; background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);">
          <span style="font-size: 18px; margin-right: 6px;">ğŸ’¬</span> Share to WhatsApp
        </button>
      </div>
    </section>
  </main>

  

  <div class="modal-backdrop" id="mockModal" onclick="closeModal(event)">
    <div class="modal-card">
      <h3 id="modalTitle">Services</h3>
      <div class="list-group">
        <div class="list-item">
          <div class="item-info">
            <b>Ramesh Drone Service</b>
            <span>ğŸ“ 2km away Â· â‚¹400/acre</span>
          </div>
          <button class="btn-sm" data-i18n="book">BOOK</button>
        </div>
        <div class="list-item">
          <div class="item-info">
            <b>Suresh Manual Spray</b>
            <span>ğŸ“ 1.5km away Â· â‚¹150/hr</span>
          </div>
          <button class="btn-sm" data-i18n="call">CALL</button>
        </div>
      </div>
      <button class="btn-text" onclick="document.getElementById('mockModal').style.display='none'" data-i18n="close">Close</button>
    </div>
  </div>

  <!-- â•â•â•â• FOOTER â•â•â•â• -->
  <footer class="agri-footer">
    <div class="footer-hacknovation">Hacknovation 2.0 project by <span>Team AgriCore</span> ğŸ’š</div>
    <div class="footer-team">Built with â¤ï¸ for Indian Farmers Â· AgriUstaad Â© 2026</div>
  </footer>

</div><button class="fab-chat" onclick="toggleChat()">ğŸ’¬</button>

<div class="chatbot-container" id="chatbotWidget">
  <div class="chat-header">
    <div class="status-dot"></div>
    <span data-i18n="chatTitle">Agronomist AI</span>
    <button class="close-chat" onclick="toggleChat()">Ã—</button>
  </div>
  <div class="chat-messages" id="chatBody">
    <div class="msg bot" data-i18n="chatWelcome">Hello! I'm your AI agronomist. How can I help your farm today? ğŸŒ±</div>
  </div>
  <div class="chat-input-area">
    <input type="text" id="chatInput" data-i18n-placeholder="chatPlaceholder" placeholder="Ask a questionâ€¦" onkeypress="handleChatKey(event)">
    <button class="btn-send" onclick="sendChat()">â¤</button>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TRANSLATION STRINGS â€” ALL UI TEXT IN ONE PLACE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const BASE_STRINGS = {
  // --- Landing Page Additions ---
  heroDesc:       "An AI-powered super app for Indian farmers â€” diagnose crop diseases, estimate yields, analyse soil health, and get real-time advisory in your own language. Built for the field, by people who care about it.",
  statLang:       "Languages",
  statModes:      "AI Scan Modes",
  statWeather:    "Weather Advisory",
  statFree:       "For Every Farmer",
  featHeading:    "What AgriUstad Can Do",
  featSub:        "Powerful AI tools designed for real farm conditions",
  // ------------------------------
  langBarLabel:   "Language:",
  radarBanner:    '<b>Community Radar:</b> 3 cases of "Leaf Blast" detected within 5km today.',

  langBarLabel:   "Language:",
  radarBanner:    '<b>Community Radar:</b> 3 cases of "Leaf Blast" detected within 5km today.',
  back:           "Back",
  map:            "Map",
  scanTitle:      "AI Field Scanner",
  scanSubtitle:   "Select a tool to begin analysis",
  modeDisease:    "Disease",
  modeYield:      "Yield",
  modeSoil:       "Soil",
  modeCrate:      "Crate",
  tipDisease:     "Detect crop diseases",
  tipYield:       "Estimate harvest yield",
  tipSoil:        "Analyse soil health",
  tipCrate:       "Inspect crate quality",
  voiceCmd:       "Voice Command",
  uploadTitle:    "Drag & Drop or Tap",
  uploadSub:      "Supports JPG, PNG Â· AI Analysis",
  uploadHint:     "â†‘ Drop image here â†‘",
  gallery:        "Gallery",
  camera:         "Camera",
  errTitle:       "Analysis Failed",
  uploading:      "Uploading imageâ€¦",
  runAnalysis:    "Run Analysis",
  diagTitle:      "Diagnosis Complete",
  aiVerified:     "AI Verified",
  ecoScore:       "Eco Score ğŸŒ",
  roiEst:         "ROI Est. ğŸ’°",
  emptyTitle:     "No Data Returned",
  emptyDesc:      "The analysis didn't return usable results. Try with a clearer image.",
  govtScheme:     "Govt Scheme",
  weatherAdv:     "Weather Advisory",
  rentTool:       "ğŸšœ Rent Tool",
  buyMeds:        "ğŸ’Š Buy Meds",
  downloadPdf:    "ğŸ“„  Download Health Passport (PDF)",
  chatTitle:      "Agronomist AI",
  chatWelcome:    "Hello! I'm your AI agronomist. How can I help your farm today? ğŸŒ±",
  chatPlaceholder:"Ask a questionâ€¦",
  book:           "BOOK",
  call:           "CALL",
  close:          "Close",
  /* diag card labels */
  labelCondition: "Condition",
  labelSeverity:  "Severity Score",
  labelTreatment: "Treatment",
  labelYield:     "Yield Estimate",
  labelReadiness: "Harvest Readiness",
  labelMarket:    "Market Advice",
  labelSoilType:  "Soil Type",
  labelMoisture:  "Moisture Level",
  labelTreatAdv:  "Treatment Advice",
  /* progress */
  progUpload:     "Uploading imageâ€¦",
  progSending:    "Sending to AIâ€¦",
  progProcessing: "Processing resultsâ€¦",
  progDone:       "Done!",
  /* error */
  errNoPhoto:     "Please capture or select a photo first!",
  /* processing btn */
  btnProcessing:  "â³  Processingâ€¦",
  btnReady:       "ğŸš€  Run Analysis",
};

/* Currently active strings (gets replaced after translation) */
let T = { ...BASE_STRINGS };

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LANGUAGE SELECTOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function selectLang(el) {
  document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
  selectedLang     = el.dataset.lang;
  selectedLangName = el.dataset.name;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ENTER APP â€” translate then reveal
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function enterApp() {
  const btn    = document.getElementById('enterBtn');
  const status = document.getElementById('langStatus');

  if (selectedLang === 'en') {
    await launchApp();
    return;
  }

  btn.disabled = true;
  btn.innerHTML = `<span class="btn-spinner"></span> Translating to ${selectedLangName}â€¦`;
  status.className = 'lang-status active';
  status.textContent = 'Auto-translating via Google Translateâ€¦';

  try {
    T = await translateStrings(BASE_STRINGS, selectedLang);
    status.textContent = 'âœ“ Translation complete â€” launchingâ€¦';
    await new Promise(r => setTimeout(r, 400));
    await launchApp();
  } catch(err) {
    btn.disabled = false;
    btn.innerHTML = 'Enter AgriUstaad â†’';
    status.className = 'lang-status error';
    status.textContent = 'âš  Translation failed: ' + (err.message || err);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FREE GOOGLE TRANSLATE â€” no API key required
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function translateStrings(strings, langCode) {
  const keys    = Object.keys(strings);
  const values  = Object.values(strings);
  const DELIM   = ' ||| ';

  const stripped = values.map(v => v.replace(/<[^>]+>/g, m => `[[${m}]]`));
  const joined   = stripped.join(DELIM);

  const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=${langCode}&dt=t&q=${encodeURIComponent(joined)}`;
  const res  = await fetch(url);
  if (!res.ok) throw new Error(`Google Translate HTTP ${res.status}`);

  const data = await res.json();
  let translated = '';
  for (const seg of data[0]) { if (seg && seg[0]) translated += seg[0]; }

  const parts  = translated.split(/\s*\|\|\|\s*/);
  const result = {};
  keys.forEach((key, i) => {
    let val = parts[i] || values[i];
    val = val.replace(/\[\[(<[^>]+>)\]\]/g, '$1');
    result[key] = val;
  });
  return { ...BASE_STRINGS, ...result };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APPLY TRANSLATIONS TO DOM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function applyTranslations() {
  // Text content
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.dataset.i18n;
    if (T[key]) el.innerHTML = T[key];
  });

  // Placeholders
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    const key = el.dataset.i18nPlaceholder;
    if (T[key]) el.placeholder = T[key];
  });

  // data-tip on mode buttons (translated)
  document.querySelectorAll('[data-tip-key]').forEach(el => {
    const key = el.dataset.tipKey;
    if (T[key]) el.setAttribute('data-tip', T[key]);
  });

  // Update lang bar
  document.getElementById('langBarName').textContent = selectedLangName;
  document.getElementById('langBar').style.display = 'flex';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CINEMATIC LAUNCH SEQUENCE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function launchApp() {
  applyTranslations();

  const overlay = document.getElementById('langOverlay');
  const flash   = document.getElementById('flashOverlay');
  const app     = document.getElementById('appWrapper');

  // 1. Hide language overlay with fade
  overlay.classList.add('hiding');

  // 2. Flash â€” green burst
  await new Promise(r => setTimeout(r, 250));
  flash.classList.add('flash-in');

  // 3. Hold flash briefly
  await new Promise(r => setTimeout(r, 180));

  // 4. Remove lang overlay from flow
  overlay.style.display = 'none';

  // 5. Fade flash out while app reveals underneath
  flash.classList.remove('flash-in');
  flash.classList.add('flash-out');
  app.classList.add('revealed');

  // 6. Clean up flash
  await new Promise(r => setTimeout(r, 1400));
  flash.style.display = 'none';

  // 7. Save lang so map/history return doesn't re-show popup
  try {
    sessionStorage.setItem('agri_lang', selectedLang);
    sessionStorage.setItem('agri_lang_name', selectedLangName);
    sessionStorage.setItem('agri_T', JSON.stringify(T));
  } catch(e) {}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET LANGUAGE â€” re-show selector
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function resetLanguage() {
  const overlay = document.getElementById('langOverlay');
  const app     = document.getElementById('appWrapper');
  const flash   = document.getElementById('flashOverlay');

  app.classList.remove('revealed');
  flash.style.display = '';
  flash.classList.remove('flash-out');
  overlay.style.display = '';
  overlay.classList.remove('hiding');

  try { sessionStorage.clear(); } catch(e) {}

  document.getElementById('enterBtn').disabled = false;
  document.getElementById('enterBtn').innerHTML = 'Enter AgriUstaad â†’';
  document.getElementById('langStatus').textContent = '';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT â€” show lang popup only on fresh visit,
   skip if returning from map/history (same session)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let geminiKey = ''; // kept for compat, unused
let selectedLang = 'en';
let selectedLangName = 'English';

(async function init() {
  try {
    const savedLang = sessionStorage.getItem('agri_lang');
    const savedName = sessionStorage.getItem('agri_lang_name');
    const savedT    = sessionStorage.getItem('agri_T');

    if (savedLang && savedName) {
      // Returning from map/history â€” skip popup, restore state instantly
      selectedLang     = savedLang;
      selectedLangName = savedName;
      if (savedT) {
        try { T = { ...BASE_STRINGS, ...JSON.parse(savedT) }; } catch(e) {}
      }
      // Pre-select correct lang button
      document.querySelectorAll('.lang-btn').forEach(b => {
        b.classList.toggle('selected', b.dataset.lang === savedLang);
      });
      // Skip animation â€” just reveal app directly
      document.getElementById('langOverlay').style.display = 'none';
      const app = document.getElementById('appWrapper');
      app.style.transition = 'none';
      app.classList.add('revealed');
      applyTranslations();
      return;
    }
  } catch(e) {}
  // Fresh visit â€” show language selector (default English pre-selected)
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APP LOGIC (all backend calls untouched)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let currMode = 'field';

function setMode(mode, el) {
  currMode = mode;
  document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
}

function previewFile(file) {
  if (!file) return;
  const img = document.getElementById('preview');
  img.src = URL.createObjectURL(file);
  img.style.display = 'block';
  document.getElementById('uploadContent').style.display = 'none';
  try {
    const dt = new DataTransfer(); dt.items.add(file);
    document.getElementById('fileIn').files = dt.files;
  } catch(e) {}
}

function handleDragOver(e) { e.preventDefault(); e.stopPropagation(); document.getElementById('uploadZone').classList.add('drag-over'); }
function handleDragLeave(e) { e.stopPropagation(); document.getElementById('uploadZone').classList.remove('drag-over'); }
function handleDrop(e) {
  e.preventDefault(); e.stopPropagation();
  document.getElementById('uploadZone').classList.remove('drag-over');
  const file = e.dataTransfer.files[0];
  if (file && file.type.startsWith('image/')) previewFile(file);
}

function openModal(type) {
  document.getElementById('mockModal').style.display = 'flex';
  document.getElementById('modalTitle').innerText = type === 'sprayer' ? "ğŸšœ " + (T.rentTool||'Rent Tool').replace(/ğŸšœ\s*/,'') : "ğŸ’Š " + (T.buyMeds||'Buy Meds').replace(/ğŸ’Š\s*/,'');
}
function closeModal(e) { if (e.target.id === 'mockModal') e.target.style.display = 'none'; }
function toggleChat() {
  const w = document.getElementById('chatbotWidget');
  w.style.display = w.style.display === 'flex' ? 'none' : 'flex';
}

function showError(boxId, msg) {
  document.getElementById(boxId).classList.add('visible');
  const m = document.getElementById(boxId + 'Msg');
  if (m) m.textContent = msg;
}
function dismissError(boxId) { document.getElementById(boxId).classList.remove('visible'); }

function setProgress(pct, label) {
  document.getElementById('progressBar').style.width = pct + '%';
  if (label) document.getElementById('progressLabel').textContent = label;
}
function showProgress() { document.getElementById('progressWrap').classList.add('visible'); }
function hideProgress() { document.getElementById('progressWrap').classList.remove('visible'); setProgress(0); }

function goBack() {
  if (window.innerWidth < 760) {
    document.getElementById('scanCard').style.display   = 'block';
    document.getElementById('resultCard').style.display = 'none';
  }
  document.getElementById('btnBack').classList.remove('visible');
  dismissError('scanError');
}

function animateRing(ringId, valId, displayText, fraction) {
  document.getElementById(ringId).style.strokeDashoffset = 176 * (1 - Math.min(fraction, 1));
  document.getElementById(valId).textContent = displayText;
}

function buildDiagCards(mode, d) {
  const container = document.getElementById('diagCards');
  const empty     = document.getElementById('emptyState');
  container.innerHTML = '';

  let rows = [];
  if (mode === 'yield') {
    rows = [
      { icon:'ğŸ', labelKey:'labelYield',     value: d.yield_estimate    },
      { icon:'ğŸ“‰', labelKey:'labelReadiness',  value: d.harvest_readiness },
      { icon:'ğŸ’¡', labelKey:'labelMarket',     value: d.market_advice     },
    ];
  } else if (mode === 'soil') {
    rows = [
      { icon:'ğŸŸ¤', labelKey:'labelSoilType',  value: d.soil_type         },
      { icon:'ğŸ’§', labelKey:'labelMoisture',  value: d.moisture_level    },
      { icon:'ğŸ§ª', labelKey:'labelTreatAdv',  value: d.treatment_advice  },
    ];
  } else {
    rows = [
      { icon:'ğŸ¦ ', labelKey:'labelCondition', value: d.disease_name },
      { icon:'âš ï¸', labelKey:'labelSeverity',  value: d.severity_score != null ? d.severity_score + '%' : null, severity: d.severity_score },
      { icon:'ğŸ’Š', labelKey:'labelTreatment', value: d.treatment_advice },
    ];
  }

  const hasData = rows.some(r => r.value != null && r.value !== '');
  if (!hasData) { empty.classList.add('visible'); return; }
  empty.classList.remove('visible');

  rows.forEach(row => {
    const card = document.createElement('div');
    card.className = 'diag-card';
    const safeVal = row.value != null ? escapeHtml(String(row.value)) : 'â€”';
    const label   = T[row.labelKey] || row.labelKey;
    let extra = '';
    if (row.severity != null) extra = `<div class="severity-bar-wrap"><div class="severity-bar-track"><div class="severity-bar-fill" style="width:${Math.min(row.severity,100)}%"></div></div></div>`;
    card.innerHTML = `<div class="diag-icon">${row.icon}</div><div class="diag-info"><div class="diag-label">${escapeHtml(label)}</div><div class="diag-value">${safeVal}</div>${extra}</div>`;
    container.appendChild(card);
  });
}

async function runAnalysis() {
  const file = document.getElementById('fileIn').files[0];
  if (!file) { showError('scanError', T.errNoPhoto || 'Please capture a photo first!'); return; }
  dismissError('scanError');

  const btn = document.getElementById('btnAnalyze');
  btn.querySelector('span[data-i18n]').textContent = (T.btnProcessing || 'â³  Processingâ€¦').replace('â³  ','');
  btn.disabled = true;

  const isWide = window.innerWidth >= 760;
  if (isWide) {
    document.getElementById('mainGrid').classList.add('two-col');
    document.getElementById('resultCard').style.display = 'block';
    document.getElementById('resultCard').classList.add('result-enter');
    document.getElementById('skelScreen').classList.add('visible');
    document.getElementById('resultContent').style.display = 'none';
  }

  showProgress();
  setProgress(15, T.progUpload || 'Uploading imageâ€¦');

  const fd = new FormData();
  fd.append('image', file); fd.append('mode', currMode);
  fd.append('lat',   document.getElementById('lat').value);
  fd.append('lon',   document.getElementById('lon').value);

  try {
    setProgress(40, T.progSending || 'Sending to AIâ€¦');
    const res  = await fetch('/analyze', { method: 'POST', body: fd });
    setProgress(75, T.progProcessing || 'Processing resultsâ€¦');
    const data = await res.json();
    setProgress(100, T.progDone || 'Done!');

    if (!isWide) {
      document.getElementById('scanCard').style.display   = 'none';
      document.getElementById('resultCard').style.display = 'block';
      document.getElementById('resultCard').classList.add('result-enter');
    }
    document.getElementById('skelScreen').classList.remove('visible');
    document.getElementById('resultContent').style.display = 'block';
    document.getElementById('pdfLink').href = `/report/${data.scan_id}`;
    document.getElementById('btnBack').classList.add('visible');

    const d = data.diagnosis || {};
    const w = data.weather   || {};
    document.getElementById('weatherText').innerText = w.status_reason || "Unavailable";

    buildDiagCards(currMode, d);

    if (currMode === 'yield' || currMode === 'soil') {
      hideMetrics();
    } else {
      document.getElementById('metricsRow').style.display = '';
      const eco = d.sustainability_score || 5;
      animateRing('ecoRing', 'scoreEco', eco + '/10', eco / 10);
      animateRing('roiRing', 'scoreRoi', T.high || 'High', 0.82);
    }
      // --- CORRECTED LOGIC ---
    if (d.govt_subsidy) {
      document.getElementById('subsidyBox').style.display = 'flex';
      document.getElementById('subsidyName').innerText = d.govt_subsidy;
      
      const linkBtn = document.getElementById('schemeLink');
      if (d.govt_scheme_url) {
        linkBtn.href = d.govt_scheme_url;
        linkBtn.style.display = 'block';
      } else {
        linkBtn.style.display = 'none';
      }
    } else {
      document.getElementById('subsidyBox').style.display = 'none';
    }
    // -----------------------
  } catch(e) {
    document.getElementById('skelScreen').classList.remove('visible');
    const isWide = window.innerWidth >= 760;
    if (!isWide) document.getElementById('resultCard').style.display = 'none';
    showError('scanError', 'Error: ' + (e.message || e));
  }

  hideProgress();
  btn.querySelector('span[data-i18n]').textContent = T.runAnalysis || 'Run Analysis';
  btn.disabled = false;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ“² NEW: NATIVE WEB SHARE API
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function shareReport() {
  // Grab the data currently displayed on the screen
  const disease = document.querySelector('.diag-value').innerText;
  const treatment = document.querySelectorAll('.diag-value')[2].innerText;
  const ecoScore = document.getElementById('scoreEco').innerText;

  const shareText = `*AgriUstad Field Report* ğŸŒ¿\n\n*Diagnosis:* ${disease}\n*Treatment:* ${treatment}\n*Eco Score:* ${ecoScore}\n\nGenerated by Team AgriCore at HackNovation 2.0!`;

  if (navigator.share) {
    try {
      await navigator.share({
        title: 'AgriUstad Diagnosis',
        text: shareText,
        url: window.location.href // Or link to your deployed app
      });
    } catch (err) {
      console.log('User cancelled share or error:', err);
    }
  } else {
    // Fallback if browser doesn't support native sharing
    alert("Sharing is not supported on this browser. Copying to clipboard instead!");
    navigator.clipboard.writeText(shareText);
  }
}

function hideMetrics() {
  document.getElementById('metricsRow').style.display = 'none';
  document.getElementById('subsidyBox').style.display = 'none';
  document.getElementById('marketGrid').style.display = 'none';
}

async function sendChat() {
  const inp = document.getElementById('chatInput');
  const txt = inp.value.trim(); if (!txt) return;
  const body = document.getElementById('chatBody');
  body.innerHTML += `<div class="msg user">${escapeHtml(txt)}</div>`;
  inp.value = ''; body.scrollTop = body.scrollHeight;
  const tid = 'typing_' + Date.now();
  body.innerHTML += `<div class="msg bot typing" id="${tid}"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>`;
  body.scrollTop = body.scrollHeight;
  try {
    const res  = await fetch('/api/chat', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({message:txt}) });
    const data = await res.json();
    document.getElementById(tid)?.remove();
    body.innerHTML += `<div class="msg bot">${escapeHtml(data.reply)}</div>`;
  } catch(e) {
    document.getElementById(tid)?.remove();
    body.innerHTML += `<div class="msg bot">âš ï¸ Couldn't reach the server.</div>`;
  }
  body.scrollTop = body.scrollHeight;
}

function handleChatKey(e) { if (e.key === 'Enter') sendChat(); }
function escapeHtml(str) { return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
if (SR) {
  const r = new SR();
  r.onstart  = () => document.getElementById('voiceBtn').classList.add('listening');
  r.onend    = () => document.getElementById('voiceBtn').classList.remove('listening');
  r.onresult = e => { const t = e.results[0][0].transcript.toLowerCase(); if(t.includes('scan')||t.includes('analyze')) runAnalysis(); };
  window.startVoiceScan = () => r.start();
}


</script>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
        .then(reg => console.log('Offline Mode Activated! Scope:', reg.scope))
        .catch(err => console.error('Offline Mode Failed:', err));
    });
  }
</script>
</body>
</html>